<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>Dashboard - Planner App</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/dashboard.css?v=2.0">
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
        <div class="container">
            <div class="row align-items-center py-4">
                <div class="col-md-6">
                    <div class="d-flex align-items-center">
                        <div class="header-logo me-3">
                            <i class="bi bi-calendar3"></i>
                        </div>
                        <div>
                            <h4 class="mb-0 header-title">
                                <span id="todayDate"></span>
                            </h4>
                            <small class="text-muted header-subtitle">Your Daily Planner</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="header-nav">
                        <div class="nav-buttons">
                            <button class="nav-btn timezone-btn" onclick="openTimezoneSettings()" title="Change Timezone">
                                <i class="bi bi-gear"></i>
                                <span class="btn-text">Timezone</span>
                            </button>
                            <a href="/reports" class="nav-btn reports-btn" title="View Reports">
                                <i class="bi bi-graph-up"></i>
                                <span class="btn-text">Reports</span>
                            </a>
                            <a href="/assistant" class="nav-btn assistant-btn" title="AI Assistant">
                                <i class="bi bi-robot"></i>
                                <span class="btn-text">Assistant</span>
                            </a>
                            <a href="/kanban" class="nav-btn kanban-btn" title="Kanban Board">
                                <i class="bi bi-columns-gap"></i>
                                <span class="btn-text">Kanban</span>
                            </a>
                            <button class="nav-btn logout-btn" onclick="logout()" title="Logout">
                                <i class="bi bi-box-arrow-right"></i>
                                <span class="btn-text">Logout</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Welcome Message Row -->
            <div class="row">
                <div class="col-12">
                    <div class="welcome-message-row">
                        <div class="welcome-container">
                            <div class="welcome-icon">
                                <i class="bi bi-person-circle"></i>
                            </div>
                            <div class="welcome-text">
                                <span class="welcome-greeting">Welcome back, </span>
                                <span class="user-name" id="userName"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <!-- Current Activity Section (restored) -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card current-activity" style="background: #fff;">
                        <div class="card-body">
                            <div class="d-flex flex-column flex-md-row align-items-center justify-content-between">
                                <div class="d-flex align-items-center mb-3 mb-md-0">
                                    <div style="background: #fff; border: 1.5px solid #e3e7f0; border-radius: 50%; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; margin-right: 1rem;">
                                        <i class="bi bi-play-circle" style="font-size: 2rem; color: #3a4a6b;"></i>
                                    </div>
                                    <div>
                                        <h4 class="mb-0" style="font-weight: 700; letter-spacing: 0.5px; color: #222;">Current Activity</h4>
                                        <div id="currentActivityInfo" style="font-size: 1.1rem; font-weight: 400; color: #444;">
                                            <p class="mb-1">No active activity</p>
                                            <small class="text-muted">Click "Clock In" to start tracking your work</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="clock-in-time mb-2" id="currentTime" style="font-size: 2.5rem; font-weight: 700; letter-spacing: 1px; color: #222;">--:--</div>
                                    <div style="font-size: 1rem; color: #666;">
                                        <span>Started at <span id="startTime">--:--</span></span>
                                    </div>
                                    <div><small class="text-muted" id="timezoneInfo">(Shows elapsed time when active)</small></div>
                                    <div class="d-flex flex-row gap-2 mt-3 w-100 justify-content-center">
                                        <button class="btn btn-outline-secondary btn-clock flex-fill" id="clockOutBtn" disabled style="min-width: 120px;">
                                            <i class="bi bi-stop-circle me-2"></i>
                                            Clock Out
                                        </button>
                                        <button class="btn btn-outline-primary btn-clock flex-fill" data-bs-toggle="modal" data-bs-target="#newActivityModal" style="min-width: 120px;">
                                            <i class="bi bi-plus-circle me-2"></i>
                                            Create New Activity
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions Section (restored) -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card quick-actions">
                        <div class="card-body d-flex flex-wrap gap-3 justify-content-center">
                            <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modelsModal">
                                <i class="bi bi-diagram-3 me-2"></i>Models
                            </button>
                            <button class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#projectsModal">
                                <i class="bi bi-folder me-2"></i>Projects
                            </button>
                            <button class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#tasksModal">
                                <i class="bi bi-list-task me-2"></i>Tasks
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar Section (unchanged) -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">
                                    <i class="bi bi-calendar3 me-2"></i>
                                    Calendar View
                                </h5>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-sm btn-outline-primary" onclick="previousMonth()">
                                        <i class="bi bi-chevron-left"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="nextMonth()">
                                        <i class="bi bi-chevron-right"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="goToToday()">
                                        Today
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <div id="calendarContainer">
                                        <div class="calendar-header mb-3">
                                            <h4 id="calendarMonthYear" class="text-center mb-0"></h4>
                                        </div>
                                        <div class="calendar-grid">
                                            <div class="calendar-weekdays">
                                                <div class="calendar-weekday">Sun</div>
                                                <div class="calendar-weekday">Mon</div>
                                                <div class="calendar-weekday">Tue</div>
                                                <div class="calendar-weekday">Wed</div>
                                                <div class="calendar-weekday">Thu</div>
                                                <div class="calendar-weekday">Fri</div>
                                                <div class="calendar-weekday">Sat</div>
                                            </div>
                                            <div id="calendarDays" class="calendar-days">
                                                <!-- Calendar days will be populated by JavaScript -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="calendar-sidebar">
                                        <h6 class="mb-3">
                                            <i class="bi bi-clock me-2"></i>
                                            Upcoming Planned Activities
                                        </h6>
                                        <div id="upcomingActivities" class="upcoming-activities">
                                            <p class="text-muted text-center">Loading upcoming activities...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reminders Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0" id="remindersSectionTitle">
                                    <i class="bi bi-bell me-2"></i>
                                    Today's Reminders
                                </h5>
                                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#newReminderModal">
                                    <i class="bi bi-plus-circle me-1"></i>Add Reminder
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-5 mb-2 mb-md-0">
                                    <input type="date" class="form-control" id="reminderStartDate" placeholder="Start date">
                                </div>
                                <div class="col-md-5 mb-2 mb-md-0">
                                    <input type="date" class="form-control" id="reminderEndDate" placeholder="End date">
                                </div>
                                <div class="col-md-2 d-flex gap-1">
                                    <button class="btn btn-primary btn-sm" id="applyReminderDateRangeBtn" onclick="applyReminderDateRange()">
                                        <i class="bi bi-funnel me-1"></i>Apply
                                    </button>
                                    <button class="btn btn-secondary btn-sm" id="clearReminderDateRangeBtn" onclick="clearReminderDateRange()">
                                        <i class="bi bi-x-circle me-1"></i>Clear
                                    </button>
                                </div>
                            </div>
                            <div id="remindersList">
                                <p class="text-muted text-center">Loading reminders...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Today's Schedule -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">
                                    <i class="bi bi-calendar-check me-2"></i>
                                    <span id="scheduleTitle">Today's Schedule</span>
                                </h5>
                                <div class="d-flex gap-2">
                                    <div class="dropdown">
                                        <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            <i class="bi bi-funnel me-1"></i>Filters
                                        </button>
                                        <div class="dropdown-menu p-3" style="width: 300px;">
                                            <h6 class="dropdown-header">Activity Filters</h6>
                                            <div class="mb-2">
                                                <label for="activityStatusFilter" class="form-label small">Status</label>
                                                <select class="form-select form-select-sm" id="activityStatusFilter">
                                                    <option value="">All Statuses</option>
                                                    <option value="PLANNED">Planned</option>
                                                    <option value="DOING">Doing</option>
                                                    <option value="DONE">Done</option>
                                                </select>
                                            </div>
                                            <div class="mb-2">
                                                <label for="activityTaskFilter" class="form-label small">Task</label>
                                                <select class="form-select form-select-sm" id="activityTaskFilter">
                                                    <option value="">All Tasks</option>
                                                </select>
                                            </div>
                                            <div class="mb-2">
                                                <label for="scheduleStartDate" class="form-label small">Start Date</label>
                                                <input type="date" class="form-control form-control-sm" id="scheduleStartDate" placeholder="Start date">
                                            </div>
                                            <div class="mb-3">
                                                <label for="scheduleEndDate" class="form-label small">End Date</label>
                                                <input type="date" class="form-control form-control-sm" id="scheduleEndDate" placeholder="End date">
                                            </div>
                                            <div class="d-flex gap-1">
                                                <button class="btn btn-primary btn-sm" onclick="applyActivityFilters()">
                                                    <i class="bi bi-funnel me-1"></i>Apply
                                                </button>
                                                <button class="btn btn-secondary btn-sm" onclick="clearActivityFilters()">
                                                    <i class="bi bi-x-circle me-1"></i>Clear
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="btn btn-sm btn-outline-secondary" id="toggleActivitiesBtn" onclick="showAllActivities()">
                                        <i class="bi bi-list me-1"></i>Show All Activities
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="scheduleList">
                                <p class="text-muted text-center">Loading schedule...</p>
                            </div>
                            <div id="paginationControls" class="d-none">
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <div class="pagination-info">
                                        <small class="text-muted">Showing <span id="currentRange"></span> of <span id="totalCount"></span> activities</small>
                                    </div>
                                    <nav aria-label="Activities pagination">
                                        <ul class="pagination pagination-sm mb-0">
                                            <li class="page-item" id="prevPageBtn">
                                                <button class="page-link" onclick="previousPage()">
                                                    <i class="bi bi-chevron-left"></i> Previous
                                                </button>
                                            </li>
                                            <li class="page-item" id="nextPageBtn">
                                                <button class="page-link" onclick="nextPage()">
                                                    Next <i class="bi bi-chevron-right"></i>
                                                </button>
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <!-- New Activity Modal -->
    <div class="modal fade" id="newActivityModal" tabindex="-1" aria-labelledby="newActivityModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newActivityModalLabel">
                        <i class="bi bi-plus-circle me-2"></i>
                        Create New Activity
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="newActivityForm">
                        <div class="mb-3">
                            <label for="activityProject" class="form-label">Select Project</label>
                            <select class="form-select" id="activityProject" required onchange="populateActivityTasks()">
                                <option value="">Choose a project...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="activityTask" class="form-label">Select Task</label>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="showDoneTasksCheckbox">
                                <label class="form-check-label" for="showDoneTasksCheckbox">
                                    Show tasks marked as done
                                </label>
                            </div>
                            <select class="form-select" id="activityTask" required disabled>
                                <option value="">Choose a task...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="activityStatus" class="form-label">Status</label>
                            <select class="form-select" id="activityStatus" required onchange="updateActivityFormFields()">
                                <option value="PLANNED">Planned</option>
                                <option value="DOING">Doing</option>
                                <option value="DONE">Done</option>
                            </select>
                        </div>
                        <div class="mb-3" id="clockInField">
                            <label for="activityClockIn" class="form-label">Clock In Time</label>
                            <input type="datetime-local" class="form-control" id="activityClockIn" required>
                        </div>
                        <div class="mb-3" id="clockOutField" style="display: none;">
                            <label for="activityClockOut" class="form-label">Clock Out Time</label>
                            <input type="datetime-local" class="form-control" id="activityClockOut">
                        </div>
                        <div class="mb-3">
                            <label for="activityDescription" class="form-label">Description (Optional)</label>
                            <textarea class="form-control" id="activityDescription" rows="3" placeholder="Add notes about what you're working on..."></textarea>
                        </div>
                        
                        <!-- Recurring Activity Section -->
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="activityRecurring" onchange="toggleRecurringFields()">
                                <label class="form-check-label" for="activityRecurring">
                                    <i class="bi bi-arrow-repeat me-2"></i>Make this a recurring activity
                                </label>
                            </div>
                        </div>
                        
                        <div id="recurringFields" style="display: none;">
                            <div class="card recurring-card">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="bi bi-calendar-plus me-2"></i>Recurring Settings
                                    </h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="activityDaysInterval" class="form-label">Days between recurrences</label>
                                            <input type="number" class="form-control" id="activityDaysInterval" min="1" value="3" placeholder="e.g., 3">
                                            <small class="text-muted">How many days between each occurrence</small>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="activityRecurrenceCount" class="form-label">Number of additional activities</label>
                                            <input type="number" class="form-control" id="activityRecurrenceCount" min="1" value="2" placeholder="e.g., 2">
                                            <small class="text-muted">How many additional activities to create</small>
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-info">
                                            <i class="bi bi-info-circle me-1"></i>
                                            Example: If you set 3 days and 2 additional activities, you'll get activities on the original date, 3 days later, and 6 days later.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="startActivityBtn">
                        <i class="bi bi-play-circle me-2"></i>
                        Create Activity
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Activity Modal -->
    <div class="modal fade" id="editActivityModal" tabindex="-1" aria-labelledby="editActivityModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editActivityModalLabel">
                        <i class="bi bi-pencil me-2"></i>
                        Edit Activity
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editActivityForm">
                        <input type="hidden" id="editActivityId">
                        <div class="mb-3">
                            <label for="editActivityProject" class="form-label">Select Project</label>
                            <select class="form-select" id="editActivityProject" required onchange="populateEditActivityTasks()">
                                <option value="">Choose a project...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editActivityTask" class="form-label">Select Task</label>
                            <select class="form-select" id="editActivityTask" required disabled>
                                <option value="">Choose a task...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editActivityStatus" class="form-label">Status</label>
                            <select class="form-select" id="editActivityStatus" required>
                                <option value="PLANNED">Planned</option>
                                <option value="DOING">Doing</option>
                                <option value="DONE">Done</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editActivityClockIn" class="form-label">Clock In Time</label>
                            <input type="datetime-local" class="form-control" id="editActivityClockIn" required>
                        </div>
                        <div class="mb-3">
                            <label for="editActivityClockOut" class="form-label">Clock Out Time (Optional)</label>
                            <input type="datetime-local" class="form-control" id="editActivityClockOut">
                        </div>
                        <div class="mb-3">
                            <label for="editActivityDescription" class="form-label">Description (Optional)</label>
                            <textarea class="form-control" id="editActivityDescription" rows="3" placeholder="Add notes about what you're working on..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateActivityBtn">
                        <i class="bi bi-check-circle me-2"></i>
                        Update Activity
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Models Modal -->
    <div class="modal fade" id="modelsModal" tabindex="-1" aria-labelledby="modelsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modelsModalLabel">
                        <i class="bi bi-diagram-3 me-2"></i>
                        Manage Models
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-12">
                            <button class="btn btn-primary" onclick="showCreateModelForm()">
                                <i class="bi bi-plus-circle me-2"></i>Create New Model
                            </button>
                        </div>
                    </div>
                    
                    <div id="createModelForm" style="display: none;" class="mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6>Create New Model</h6>
                            </div>
                            <div class="card-body">
                                <form id="newModelForm">
                                    <div class="mb-3">
                                        <label for="modelName" class="form-label">Model Name</label>
                                        <input type="text" class="form-control" id="modelName" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="modelBaseUrl" class="form-label">Base URL</label>
                                        <input type="url" class="form-control" id="modelBaseUrl" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="modelApiKey" class="form-label">API Key</label>
                                        <input type="text" class="form-control" id="modelApiKey" required>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-success">
                                            <i class="bi bi-check-circle me-2"></i>Create Model
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="hideCreateModelForm()">
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div id="modelsList">
                        <p class="text-muted text-center">Loading models...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Projects Modal -->
    <div class="modal fade" id="projectsModal" tabindex="-1" aria-labelledby="projectsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="projectsModalLabel">
                        <i class="bi bi-folder me-2"></i>
                        Manage Projects
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-12">
                            <button class="btn btn-success" onclick="showCreateProjectForm()">
                                <i class="bi bi-plus-circle me-2"></i>Create New Project
                            </button>
                        </div>
                    </div>
                    
                    <div id="createProjectForm" style="display: none;" class="mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6>Create New Project</h6>
                            </div>
                            <div class="card-body">
                                <form id="newProjectForm">
                                    <div class="mb-3">
                                        <label for="projectName" class="form-label">Project Name</label>
                                        <input type="text" class="form-control" id="projectName" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="projectColor" class="form-label">Color</label>
                                        <input type="color" class="form-control" id="projectColor" value="#007bff" required>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-success">
                                            <i class="bi bi-check-circle me-2"></i>Create Project
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="hideCreateProjectForm()">
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div id="projectsList">
                        <p class="text-muted text-center">Loading projects...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tasks Modal -->
    <div class="modal fade" id="tasksModal" tabindex="-1" aria-labelledby="tasksModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" style="max-width:98vw; width:98vw;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="tasksModalLabel">
                        <i class="bi bi-list-task me-2"></i>
                        Manage Tasks
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-12">
                            <button class="btn btn-info" onclick="showCreateTaskForm()">
                                <i class="bi bi-plus-circle me-2"></i>Create New Task
                            </button>
                        </div>
                    </div>
                    
                    <!-- Advanced Filters Section -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="bi bi-funnel me-2"></i>Advanced Filters
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <!-- State Filter -->
                                        <div class="col-md-3 mb-2">
                                            <label for="stateFilter" class="form-label">State</label>
                                            <select class="form-select" id="stateFilter">
                                                <option value="">All States</option>
                                                <option value="open">Open</option>
                                                <option value="todo">Todo</option>
                                                <option value="doing">Doing</option>
                                                <option value="done">Done</option>
                                                <option value="closed">Closed</option>
                                            </select>
                                        </div>
                                        
                                        <!-- Project Filter -->
                                        <div class="col-md-3 mb-2">
                                            <label for="projectFilter" class="form-label">Project</label>
                                            <select class="form-select" id="projectFilter">
                                                <option value="">All Projects</option>
                                            </select>
                                        </div>
                                        
                                        <!-- Energy Level Filter -->
                                        <div class="col-md-3 mb-2">
                                            <label for="energyFilter" class="form-label">Energy Level</label>
                                            <select class="form-select" id="energyFilter">
                                                <option value="">All Levels</option>
                                                <option value="LOW">Low</option>
                                                <option value="MEDIUM">Medium</option>
                                                <option value="HIGH">High</option>
                                            </select>
                                        </div>
                                        
                                        <!-- Importance Filter -->
                                        <div class="col-md-3 mb-2">
                                            <label for="importanceFilter" class="form-label">Importance</label>
                                            <select class="form-select" id="importanceFilter">
                                                <option value="">All</option>
                                                <option value="important">Important</option>
                                                <option value="not_important">Not Important</option>
                                            </select>
                                        </div>
                                        
                                        <!-- Urgency Filter -->
                                        <div class="col-md-3 mb-2">
                                            <label for="urgencyFilter" class="form-label">Urgency</label>
                                            <select class="form-select" id="urgencyFilter">
                                                <option value="">All</option>
                                                <option value="urgent">Urgent</option>
                                                <option value="not_urgent">Not Urgent</option>
                                            </select>
                                        </div>
                                        
                                        <!-- Deadline Filter -->
                                        <div class="col-md-3 mb-2">
                                            <label for="deadlineFilterDate" class="form-label">Deadline</label>
                                            <input type="date" class="form-control" id="deadlineFilterDate" placeholder="Select date">
                                        </div>
                                        
                                        <!-- Parent Task Filter -->
                                        <div class="col-md-3 mb-2">
                                            <label for="parentTaskFilter" class="form-label">Parent Task</label>
                                            <select class="form-select" id="parentTaskFilter">
                                                <option value="">All Tasks</option>
                                                <option value="no_parent">No Parent (Top Level)</option>
                                            </select>
                                        </div>
                                        
                                        <!-- Filter Actions -->
                                        <div class="col-md-6 mb-2 d-flex align-items-end">
                                            <div class="d-flex gap-2">
                                                <button class="btn btn-outline-primary" onclick="applyTaskFilters()">
                                                    <i class="bi bi-funnel me-1"></i>Apply Filters
                                                </button>
                                                <button class="btn btn-outline-secondary" onclick="clearTaskFilters()">
                                                    <i class="bi bi-x-circle me-1"></i>Clear All
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="createTaskForm" style="display: none;" class="mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6>Create New Task</h6>
                            </div>
                            <div class="card-body">
                                <form id="newTaskForm">
                                    <div class="mb-3">
                                        <label for="taskTitle" class="form-label">Task Title</label>
                                        <input type="text" class="form-control" id="taskTitle" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="taskProject" class="form-label">Project</label>
                                        <select class="form-select" id="taskProject" required>
                                            <option value="">Select project...</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="taskParent" class="form-label">Parent Task (Optional)</label>
                                        <select class="form-select" id="taskParent">
                                            <option value="">No Parent (Top Level Task)</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="taskEnergy" class="form-label">Energy Level</label>
                                        <select class="form-select" id="taskEnergy" required>
                                            <option value="">Select energy level...</option>
                                            <option value="LOW">Low</option>
                                            <option value="MEDIUM">Medium</option>
                                            <option value="HIGH">High</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="taskState" class="form-label">State</label>
                                        <select class="form-select" id="taskState" required>
                                            <option value="">Select state...</option>
                                            <option value="open">Open</option>
                                            <option value="todo">Todo</option>
                                            <option value="doing">Doing</option>
                                            <option value="done">Done</option>
                                            <option value="closed">Closed</option>
                                        </select>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="taskImportant">
                                                <label class="form-check-label" for="taskImportant">
                                                    Important
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="taskUrgent">
                                                <label class="form-check-label" for="taskUrgent">
                                                    Urgent
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="taskDeadline" class="form-label">Deadline (Optional)</label>
                                        <input type="datetime-local" class="form-control" id="taskDeadline">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Progress Tracking</label>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label for="taskProgressUnit" class="form-label">Unit</label>
                                                <input type="text" class="form-control" id="taskProgressUnit" placeholder="e.g., pages, hours, %" required>
                                            </div>
                                            <div class="col-md-4">
                                                <label for="taskProgressValue" class="form-label">Current Value</label>
                                                <input type="number" class="form-control" id="taskProgressValue" value="0" min="0" required>
                                            </div>
                                            <div class="col-md-4">
                                                <label for="taskProgressMax" class="form-label">Max Value</label>
                                                <input type="number" class="form-control" id="taskProgressMax" value="100" min="1" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-success">
                                            <i class="bi bi-check-circle me-2"></i>Create Task
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="hideCreateTaskForm()">
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div id="tasksList">
                        <p class="text-muted text-center">Loading tasks...</p>
                    </div>
                    
                    <!-- Tasks Pagination -->
                    <div id="tasksPagination" class="d-none">
                        <div class="row">
                            <div class="col-md-6">
                                <p class="text-muted mb-0">
                                    Showing <span id="tasksStartIndex">0</span> to <span id="tasksEndIndex">0</span> 
                                    of <span id="tasksTotalCount">0</span> tasks
                                </p>
                            </div>
                            <div class="col-md-6">
                                <nav aria-label="Tasks pagination">
                                    <ul class="pagination justify-content-end mb-0">
                                        <li class="page-item">
                                            <button class="page-link" id="tasksPrevBtn" onclick="tasksPreviousPage()">
                                                <i class="bi bi-chevron-left"></i> Previous
                                            </button>
                                        </li>
                                        <li class="page-item">
                                            <span class="page-link" id="tasksPageInfo">Page 1 of 1</span>
                                        </li>
                                        <li class="page-item">
                                            <button class="page-link" id="tasksNextBtn" onclick="tasksNextPage()">
                                                Next <i class="bi bi-chevron-right"></i>
                                            </button>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;">
        <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i id="toastIcon" class="bi me-2"></i>
                <strong id="toastTitle" class="me-auto"></strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div id="toastBody" class="toast-body"></div>
        </div>
    </div>
    
    <!-- Progress Edit Modal -->
    <div class="modal fade" id="progressEditModal" tabindex="-1" aria-labelledby="progressEditModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="progressEditModalLabel">
                        <i class="bi bi-graph-up me-2"></i>
                        Update Progress
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="progressEditForm">
                        <input type="hidden" id="editProgressId">
                        <input type="hidden" id="editProgressTaskId">
                        <div class="mb-3">
                            <label for="editProgressUnit" class="form-label">Unit</label>
                            <input type="text" class="form-control" id="editProgressUnit" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="editProgressValue" class="form-label">Current Value</label>
                            <input type="number" class="form-control" id="editProgressValue" min="0" required>
                        </div>
                        <div class="mb-3">
                            <label for="editProgressMax" class="form-label">Max Value</label>
                            <input type="number" class="form-control" id="editProgressMax" min="1" readonly>
                        </div>
                        <div class="mb-3">
                            <div class="progress">
                                <div class="progress-bar" id="editProgressBar" role="progressbar" style="width: 0%"></div>
                            </div>
                            <small class="text-muted" id="editProgressText">0%</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateProgressBtn">
                        <i class="bi bi-check-circle me-2"></i>Update Progress
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Delete Modal -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteModalLabel">
                        <i class="bi bi-exclamation-triangle text-warning me-2"></i>
                        Confirm Deletion
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="confirmDeleteBody"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelDeleteBtn">
                        <i class="bi bi-x-circle me-2"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <i class="bi bi-trash me-2"></i>Delete
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Project Modal -->
    <div class="modal fade" id="editProjectModal" tabindex="-1" aria-labelledby="editProjectModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProjectModalLabel">
                        <i class="bi bi-pencil me-2"></i>Edit Project
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editProjectForm">
                        <input type="hidden" id="editProjectId">
                        <div class="mb-3">
                            <label for="editProjectName" class="form-label">Project Name</label>
                            <input type="text" class="form-control" id="editProjectName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editProjectColor" class="form-label">Color</label>
                            <input type="color" class="form-control" id="editProjectColor" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateProjectBtn">
                        <i class="bi bi-check-circle me-2"></i>Update Project
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Model Modal -->
    <div class="modal fade" id="editModelModal" tabindex="-1" aria-labelledby="editModelModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModelModalLabel">
                        <i class="bi bi-pencil me-2"></i>Edit Model
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editModelForm">
                        <input type="hidden" id="editModelId">
                        <div class="mb-3">
                            <label for="editModelName" class="form-label">Model Name</label>
                            <input type="text" class="form-control" id="editModelName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editModelBaseUrl" class="form-label">Base URL</label>
                            <input type="url" class="form-control" id="editModelBaseUrl" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateModelBtn">
                        <i class="bi bi-check-circle me-2"></i>Update Model
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div class="modal fade" id="editTaskModal" tabindex="-1" aria-labelledby="editTaskModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editTaskModalLabel">
                        <i class="bi bi-pencil me-2"></i>Edit Task
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editTaskForm">
                        <input type="hidden" id="editTaskId">
                        <div class="mb-3">
                            <label for="editTaskTitle" class="form-label">Task Title</label>
                            <input type="text" class="form-control" id="editTaskTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskProject" class="form-label">Project</label>
                            <select class="form-select" id="editTaskProject" required>
                                <option value="">Select project...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskParent" class="form-label">Parent Task (Optional)</label>
                            <select class="form-select" id="editTaskParent">
                                <option value="">No Parent (Top Level Task)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskEnergy" class="form-label">Energy Level</label>
                            <select class="form-select" id="editTaskEnergy" required>
                                <option value="">Select energy level...</option>
                                <option value="LOW">Low</option>
                                <option value="MEDIUM">Medium</option>
                                <option value="HIGH">High</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskState" class="form-label">State</label>
                            <select class="form-select" id="editTaskState" required>
                                <option value="">Select state...</option>
                                <option value="open">Open</option>
                                <option value="todo">Todo</option>
                                <option value="doing">Doing</option>
                                <option value="done">Done</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="editTaskImportant">
                                    <label class="form-check-label" for="editTaskImportant">
                                        Important
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="editTaskUrgent">
                                    <label class="form-check-label" for="editTaskUrgent">
                                        Urgent
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskDeadline" class="form-label">Deadline (Optional)</label>
                            <input type="datetime-local" class="form-control" id="editTaskDeadline">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="deleteTaskBtn">
                        <i class="bi bi-trash me-2"></i>Delete Task
                    </button>
                    <button type="button" class="btn btn-primary" id="updateTaskBtn">
                        <i class="bi bi-check-circle me-2"></i>Update Task
                    </button>
                    <button type="button" class="btn btn-outline-info" id="addNoteBtn">
                        <i class="bi bi-journal-plus me-2"></i>Add Note
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/dashboard.js?v=3.5"></script>

    <!-- New Reminder Modal -->
    <div class="modal fade" id="newReminderModal" tabindex="-1" aria-labelledby="newReminderModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newReminderModalLabel">
                        <i class="bi bi-plus-circle me-2"></i>
                        Create New Reminder
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="newReminderForm">
                        <div class="mb-3">
                            <label for="reminderWhen" class="form-label">When</label>
                            <input type="datetime-local" class="form-control" id="reminderWhen" required>
                        </div>
                        <div class="mb-3">
                            <label for="reminderNote" class="form-label">Note</label>
                            <textarea class="form-control" id="reminderNote" rows="3" placeholder="What do you want to be reminded about?" required></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-circle me-2"></i>
                                Create Reminder
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Reminder Modal -->
    <div class="modal fade" id="editReminderModal" tabindex="-1" aria-labelledby="editReminderModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editReminderModalLabel">
                        <i class="bi bi-pencil me-2"></i>
                        Edit Reminder
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editReminderForm">
                        <input type="hidden" id="editReminderId">
                        <div class="mb-3">
                            <label for="editReminderWhen" class="form-label">When</label>
                            <input type="datetime-local" class="form-control" id="editReminderWhen" required>
                        </div>
                        <div class="mb-3">
                            <label for="editReminderNote" class="form-label">Note</label>
                            <textarea class="form-control" id="editReminderNote" rows="3" placeholder="What do you want to be reminded about?" required></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-circle me-2"></i>
                                Update Reminder
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Timezone Settings Modal -->
    <div class="modal fade" id="timezoneSettingsModal" tabindex="-1" aria-labelledby="timezoneSettingsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="timezoneSettingsModalLabel">
                        <i class="bi bi-gear me-2"></i>
                        Timezone Settings
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="timezoneSettingsForm">
                        <div class="mb-3">
                            <label for="timezoneCountrySelect" class="form-label">Select Country</label>
                            <select class="form-select" id="timezoneCountrySelect" required>
                                <option value="">Loading countries...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="timezoneCitySelect" class="form-label">Select City</label>
                            <select class="form-select" id="timezoneCitySelect" required disabled>
                                <option value="">Select a country first</option>
                            </select>
                            <div class="form-text">This will affect how times are displayed throughout the app.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Current Time in Selected Timezone</label>
                            <div class="form-control-plaintext" id="timezonePreview">--:--</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateTimezone()">
                        <i class="bi bi-check-circle me-1"></i>
                        Save Timezone
                    </button>
                </div>
            </div>
        </div>
    </div>

</body>
</html> 